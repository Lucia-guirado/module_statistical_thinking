---
title: "AirBnB Madrid - Optimizaci√≥n de Precios"
format:
  html:
    theme: morph
    code-fold: true
    code-tools: false
    code-summary: "Ver c√≥digo"
    code-overflow: wrap
    toc: true
    toc-location: left
    toc-depth: 2
    embed-resources: true
    css: styles.css
    output-file: "index.html"
execute:
  echo: false
  warning: false
  message: false
  error: false
editor: 
  markdown: 
    wrap: sentence
---

::: {style="display:inline-block;"}
<link href="https://cdn-icons-png.flaticon.com/128/3916/3916763.png" rel="icon">

<h6>

Luc√≠a Moreno Guirado

Masters in Data Analytics

Module 3: Statistical Thinking

</h6>

::: {style="text-align:center"}
 </a> <a href="https://github.com/Lucia-guirado" title="Visit my GitHub" target="_blank" class="btn btn-light" style="margin: 10px; padding: 7;"> <img src="https://cdn-icons-png.flaticon.com/512/25/25231.png" alt="GitHub" class="icon-link" width="25" height="25"/> </a> <a href="https://www.linkedin.com/in/luc%C3%ADa-moreno-guirado-402233290/" title="Visit my LinkedIn" target="_blank"class="btn btn-light" style="margin: 10px; padding: 7;"> <img src="https://cdn-icons-png.flaticon.com/512/61/61109.png" alt="LinkedIn" class="icon-link" width="25" height="25"/> </a>
:::
:::


```{=html}
<script>
  // ============= SCROLL TO TOP =============
  window.onscroll = () => {
    document.getElementById("scrollToTopContainer").style.display = 
      (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) ? "block" : "none";
  };

  function goToTop() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
  }


  // ============= GALLERY ZOOM =============
  let zoomInitialized = false;
  
  function setupImageGallery() {
    if (zoomInitialized) return; // Evitar m√∫ltiples inicializaciones
    
    // Usar delegaci√≥n de eventos en el documento
    document.addEventListener('click', function(e) {
      // Buscar el contenedor de figura m√°s cercano
      const figure = e.target.closest('.matplotlib-figure-custom');
      
      if (figure) {
        e.preventDefault();
        console.log('Figura clickeada:', figure); // Debug
        
        // Buscar la imagen, SVG o canvas dentro del contenedor
        let imgElement = figure.querySelector('img, svg, canvas');
        
        if (!imgElement) {
          // Si no encuentra, tomar una captura del contenedor
          imgElement = figure.querySelector('div > img, div > svg, div > canvas') || figure;
        }
        
        console.log('Elemento imagen encontrado:', imgElement); // Debug
        
        createZoomModal(imgElement);
      }
    });
    
    zoomInitialized = true;
    console.log('Sistema de zoom inicializado'); // Debug
  }
  
  function createZoomModal(element) {
    console.log('Creando modal para:', element); // Debug
    
    // Crear modal usando las clases CSS definidas
    const modal = document.createElement('div');
    modal.className = 'zoom-modal active';
    
    // Crear contenedor del contenido
    const content = document.createElement('div');
    content.className = 'zoom-content';
    
    // Bot√≥n de cerrar
    const closeBtn = document.createElement('button');
    closeBtn.className = 'zoom-close';
    closeBtn.innerHTML = '√ó';
    closeBtn.title = 'Cerrar (ESC)';
    
    // Clonar el elemento y asegurar que sea visible
    const clonedElement = element.cloneNode(true);
    
    // Limpiar estilos que puedan interferir
    clonedElement.style.cssText = '';
    clonedElement.style.maxWidth = 'none';
    clonedElement.style.maxHeight = 'none';
    clonedElement.style.width = 'auto';
    clonedElement.style.height = 'auto';
    clonedElement.style.display = 'block';
    clonedElement.style.margin = '0';
    clonedElement.style.padding = '0';
    clonedElement.style.border = 'none';
    clonedElement.style.background = 'transparent';
    clonedElement.style.position = 'static';
    
    // Si es SVG, asegurar dimensiones
    if (clonedElement.tagName === 'svg') {
      clonedElement.setAttribute('width', '100%');
      clonedElement.setAttribute('height', 'auto');
    }
    
    console.log('Elemento clonado:', clonedElement); // Debug
    
    // Ensamblar modal
    content.appendChild(closeBtn);
    content.appendChild(clonedElement);
    modal.appendChild(content);
    
    // Agregar al DOM
    document.body.appendChild(modal);
    
    // Forzar reflow para activar animaci√≥n
    modal.offsetHeight;
    
    // Prevenir scroll
    document.body.style.overflow = 'hidden';
    
    console.log('Modal agregado al DOM'); // Debug
    
    // Funci√≥n de cierre
    const closeModal = () => {
      console.log('Cerrando modal'); // Debug
      modal.remove();
      document.body.style.overflow = '';
      document.removeEventListener('keydown', handleEsc);
    };
    
    // Event listeners
    closeBtn.onclick = closeModal;
    modal.onclick = (e) => {
      if (e.target === modal) closeModal();
    };
    
    // ESC key
    const handleEsc = (e) => {
      if (e.key === 'Escape') closeModal();
    };
    document.addEventListener('keydown', handleEsc);
  }

  // Inicializaci√≥n simple
  document.addEventListener('DOMContentLoaded', function() {
    setupImageGallery();
  });
  
  // Backup initialization
  setTimeout(() => {
    if (!zoomInitialized) {
      setupImageGallery();
    }
  }, 2000);
</script>
```
::: index
# Index

-   [1. Contexto del Problema](#contexto)
-   [2. Definici√≥n del Problema](#problema)
-   [3. Roadmap del An√°lisis](#roadmap)
-   [4. Carga y Exploraci√≥n de Datos](#datos)
-   [5. An√°lisis del Precio de las Vivendas por Barrio](#geografia)
-   [6. An√°lisis de Hip√≥tesis](#hipotesis)
-   [7. Recomendaciones](#recomendaciones)
-   [8. Conclusiones](#conclusiones)

:::

```{python}
#| label: setup
#| code-summary: "Configuraci√≥n inicial y librer√≠as"

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import plotly.express as px
import plotly.graph_objects as go
from plotly.subplots import make_subplots
import warnings
from IPython.display import HTML, display
warnings.filterwarnings('ignore')
import plotly.io as pio
pio.renderers.default = "iframe_connected"


# ============= COLORES CENTRALIZADOS =============
# Colores controlados por variables CSS en styles.css
FIGURE_COLORS = {
    'primary': '#9CAF88',
    'secondary': '#A8B99C', 
    'accent': '#87A96B',
    'dark': '#6B7F5C',
    'light': '#E8F4E6',
    'complement': '#B8C9A4'
}
LIGHTER_BG = '#F8FBF6'

# ============= CONFIGURACI√ìN DE ESTILO =============
plt.style.use('seaborn-v0_8')
colors = list(FIGURE_COLORS.values())
sns.set_palette(colors)

# Configuraci√≥n matplotlib
plt.rcParams.update({
    'figure.figsize': (5, 3),
    'figure.dpi': 120,
    'font.size': 10,
    'axes.titlesize': 12,
    'axes.labelsize': 10,
    'xtick.labelsize': 9,
    'ytick.labelsize': 9,
    'legend.fontsize': 9,
    'axes.prop_cycle': plt.cycler(color=colors),
    'axes.facecolor': LIGHTER_BG,
    'figure.facecolor': 'white',
    'axes.edgecolor': FIGURE_COLORS['dark'],
    'axes.linewidth': 1.2,
    'grid.color': FIGURE_COLORS['secondary'],
    'grid.alpha': 0.3
})

# ============= FUNCIONES HELPER =============
import os
import base64
from io import BytesIO

# Crear carpeta para im√°genes si no existe
os.makedirs('figures', exist_ok=True)

def plot_start():
    """Iniciar contenedor de gr√°fico"""
    plt.figure(figsize=(5, 3));
    
def plot_end(save_name=None):
    """Finalizar y mostrar gr√°fico guardando como imagen"""
    plt.tight_layout()
    
    if save_name is None:
        # Generar nombre √∫nico basado en timestamp
        import time
        save_name = f"fig_{int(time.time()*1000)}"
    
    # Guardar imagen
    filepath = f'figures/{save_name}.png'
    plt.savefig(filepath, dpi=150, bbox_inches='tight', 
                facecolor='white', edgecolor='none')
    plt.close()
    
    # Mostrar con etiqueta HTML
    display(HTML(f'''
    <div class="matplotlib-figure-custom">
        <img src="{filepath}" alt="Figure" style="max-width: 100%; height: auto;
        margin-top:10px;">
    </div>
    '''))

def get_colormap():
    """Colormap personalizado"""
    from matplotlib.colors import LinearSegmentedColormap
    return LinearSegmentedColormap.from_list("sage", 
        [FIGURE_COLORS['light'], FIGURE_COLORS['primary'], FIGURE_COLORS['dark']])

```
# Contexto del Problema {#contexto}

Uno de nuestros clientes opera en el mercado de inmuebles. Est√° especialmente interesado en Madrid, donde posee una cantidad importante de viviendas
publicadas en la plataforma AirBnB y nos pide que le asesoremos respondiendo a la siguiente pregunta:

<div style="text-align:center; color:'#6B7F5C' ; font-size:larger; font-weight:bold; border: 2px '#6B7F5C'; padding: 10px;">
    ¬øQu√© puedo hacer para optimizar el precio de mis viviendas?
</div>

# Definici√≥n del Problema {#problema}

Nuestro cliente busca mejorar el rendimiento econ√≥mico de sus viviendas, identificando acciones que pueda aumentar el precio de sus alojamientos.
Nuestro objetivo es analizar los factores que influyen en la fijaci√≥n de los precios de Airbnb, mediante datos de propiedades de Airbnb en Madrid, y proporcionar una serie de estrategias pr√°cticas basadas en datos, que permitan al cliente aumentar el precio de sus viviendas.


# Roadmap del Proyecto {#roadmap}

```{=html}
<div style="display:flex; justify-content:center; margin: 40px 0;">
    <div style="display:flex; flex-direction:column; gap:0;">
        <!-- Preparar datos -->
        <div style="display:flex; align-items:flex-start; gap:1.5em; margin-bottom:2.5em;">
            <div style="display:flex; flex-direction:column; align-items:center; gap:1em;">
                <div style="width:1.8em; height:1.8em; border-radius:50%; background:#4F8A8B; color:white; display:flex; align-items:center; justify-content:center; font-size:1em; flex-shrink:0;">‚öôÔ∏è</div>
                <div style="width:3px; height:80px; background:#4F8A8B;"></div>
            </div>
            <div style="padding-top:0.3em;">
                <div style="font-weight:bold; color:#4F8A8B; font-size:1.1em;">Preparar datos</div>
                <div style="font-size:0.9em; color:#666;">Limpieza y variables</div>
            </div>
        </div>
        
        <!-- Explorar -->
        <div style="display:flex; align-items:flex-start; gap:1.5em; margin-bottom:2.5em; margin-left:0;">
            <div style="display:flex; flex-direction:column; align-items:center; gap:1em;">
                <div style="width:1.8em; height:1.8em; border-radius:50%; background:#4F8A8B; color:white; display:flex; align-items:center; justify-content:center; font-size:1em; flex-shrink:0;">üîç</div>
                <div style="width:3px; height:80px; background:#4F8A8B;"></div>
            </div>
            <div style="padding-top:0.3em;">
                <div style="font-weight:bold; color:#4F8A8B; font-size:1.1em;">Explorar</div>
                <div style="font-size:0.9em; color:#666;">An√°lisis y visualizaciones</div>
            </div>
        </div>
        
        <!-- Hip√≥tesis -->
        <div style="display:flex; align-items:flex-start; gap:1.5em; margin-bottom:2.5em; margin-left:0;">
            <div style="display:flex; flex-direction:column; align-items:center; gap:1em;">
                <div style="width:1.8em; height:1.8em; border-radius:50%; background:#4F8A8B; color:white; display:flex; align-items:center; justify-content:center; font-size:1em; flex-shrink:0;">üß†</div>
                <div style="width:3px; height:80px; background:#4F8A8B;"></div>
            </div>
            <div style="padding-top:0.3em;">
                <div style="font-weight:bold; color:#4F8A8B; font-size:1.1em;">Hip√≥tesis</div>
                <div style="font-size:0.9em; color:#666;">Drivers e impacto</div>
            </div>
        </div>
        <!-- Acciones -->
        <div style="display:flex; align-items:flex-start; gap:1.5em; margin-bottom:2.5em; margin-left:0;">
            <div style="display:flex; flex-direction:column; align-items:center; gap:1em;">
                <div style="width:1.8em; height:1.8em; border-radius:50%; background:#4F8A8B; color:white; display:flex; align-items:center; justify-content:center; font-size:1em; flex-shrink:0;">üíº</div>
                <div style="width:3px; height:80px; background:#4F8A8B;"></div>
            </div>
            <div style="padding-top:0.3em;">
                <div style="font-weight:bold; color:#4F8A8B; font-size:1.1em;">Acciones</div>
                <div style="font-size:0.9em; color:#666;">Quick wins operacionales</div>
            </div>
        </div>

    </div>
</div>
```
# Carga y Exploraci√≥n de Datos {#datos}

### Carga de Datasets
EXPLICAR

```{python}
# Cargar los diferentes datasets
data_path = 'data/'

# Cargar cada archivo parquet
df_host = pd.read_parquet(data_path + 'airbnb_madrid_host.parquet')
df_property = pd.read_parquet(data_path + 'airbnb_madrid_property.parquet')
df_location = pd.read_parquet(data_path + 'airbnb_madrid_location.parquet')
df_conditions = pd.read_parquet(data_path + 'airbnb_madrid_conditions.parquet')
df_reviews = pd.read_parquet(data_path + 'airbnb_madrid_reviews.parquet')

print("Datasets cargados exitosamente:")
print(f"Host: {df_host.shape}")
print(f"Property: {df_property.shape}")
print(f"Location: {df_location.shape}")
print(f"Conditions: {df_conditions.shape}")
print(f"Reviews: {df_reviews.shape}")
```

### Descripci√≥n de Tablas

EXPLICAR

```{python}
# Descripci√≥n de las variables principales
import pandas as pd
from IPython.display import HTML, display

datasets_info = pd.DataFrame({
    'Dataset': ["Host","Localizaci√≥n", "Propiedad", "Condiciones", "Rese√±as"],
    'Descripci√≥n': [
        "Informaci√≥n del anfitri√≥n (senority, verificado)",
        "Ubicaci√≥n geogr√°fica (barrio, coordenadas, distancias)",
        "Caracter√≠sticas de la propiedad (tipo, habitaciones, amenidades)",
        "Condiciones de reserva (precio, pol√≠ticas de cancelaci√≥n, m√≠nimo de noches)",
        "Historial de rese√±as (puntuaciones, cantidad, actividad)"
    ],
    'Variables_Clave': [
        "host_response_time",
        "neighbourhood",
        "property_type, amenities, bedrooms",
        "price, minimum_nights, cancellation_policy", 
        "number_of_reviews, review_scores_cleanliness "
    ]
})

# Mostrar como tabla HTML renderizada
html_table = datasets_info.to_html(index=False, table_id="datasets_table", 
                                  classes="table table-striped table-hover",
                                  escape=False, border=0)
display(HTML(html_table))
```

### Fusi√≥n de Datasets
EXPLICAR
 
```{python}
# Fusionar todos los datasets por 'id'
df = df_host.merge(df_property, on='id', how='inner') \
    .merge(df_location, on='id', how='inner') \
    .merge(df_conditions, on='id', how='inner') \
    .merge(df_reviews, on='id', how='inner')

print(f"Dataset fusionado: {df.shape}")
# print(f"Propiedades √∫nicas: {df['id'].nunique()}")

# # Informaci√≥n b√°sica del dataset
# print("\nInformaci√≥n general:")
# print(df.info())
```

### Transformaci√≥n y filtrado de los datos

Se ha realizado un filtrado de los datos para centrarse √∫nicamente en las viviendas que presentan caracter√≠sticas comparables a las de la cartera del cliente.
```{python}
df = df.query("property_type == 'apartment' and bedrooms <= 3 and bedrooms >=1 and bathrooms <= 2 and minimum_nights <= 7" )
df.shape

# Convertir variables categ√≥ricas
if 'bedrooms' in df.columns:
    df['bedrooms'] = df['bedrooms'].astype('category')
if 'minimum_nights' in df.columns:
    df['minimum_nights'] = df['minimum_nights'].astype('category')
if 'cancellation_policy' in df.columns:
    df['cancellation_policy'] = df['cancellation_policy'].astype('category')
```

```{python}
plot_start()
sns.histplot(
    data= df,
    x='price'
)
plot_end()

# Calcular cuartiles
Q1 = df['price'].quantile(0.25)
Q3 = df['price'].quantile(0.75)
IQR = Q3 - Q1

# Definir l√≠mites de valores v√°lidos
lower_bound = Q1 - 1.5 * IQR
upper_bound = Q3 + 1.5 * IQR

# Filtrar DataFrame eliminando outliers
df = df[(df['price'] >= lower_bound) & (df['price'] <= upper_bound)]

# Verificar
print(df.shape)
```

EXPLICAR QUE DE NO SE CUENTAS PUBLICACIONES SE NOS QUEDAN EN OTRAS NO SE CUANTAS
```{python}
plot_start()
sns.histplot(
    data= df,
    x='price'
)
plot_end()
```

EXPLICAR AMBOS GRAFICOS:


### Estad√≠sticas Descriptivas

```{python}
# Estad√≠sticas b√°sicas de la variable objetivo: precio
print("ESTAD√çSTICAS DEL PRECIO:")
print(f"Precio promedio: ‚Ç¨{df['price'].mean():.2f}")
print(f"Precio mediano: ‚Ç¨{df['price'].median():.2f}")
print(f"Precio m√≠nimo: ‚Ç¨{df['price'].min():.2f}")
print(f"Precio m√°ximo: ‚Ç¨{df['price'].max():.2f}")
print(f"Desviaci√≥n est√°ndar: ‚Ç¨{df['price'].std():.2f}")

# Distribuci√≥n de precios por cuartiles
quartiles = df['price'].quantile([0.25, 0.5, 0.75, 0.95])
print(f"\nDistribuci√≥n de precios:")
for q, price in quartiles.items():
    print(f"  {q*100:.0f}% de propiedades: ‚â§ ‚Ç¨{price:.2f}")
```

explicar los resultados

## An√°lisis Exploratorio {#exploratorio}

### Variables Clave a Analizar

#### Localizaci√≥n
- Barrio y distrito

#### Caracter√≠sticas de la Propiedad
- Tipo de propiedad
- N√∫mero de habitaciones
- Amenidades (WiFi, TV, aire acondicionado, etc.)

#### Condiciones de la vivienda
- Pol√≠tica de cancelaci√≥n
- M√≠nimo de noches

#### Historial y Rese√±as
- N√∫mero de rese√±as de limpieza

### An√°lisis por Ubicaci√≥n
EXPLICAR
```{python}
# An√°lisis por barrios - Top 12 barrios por n√∫mero de propiedades
top_neighborhoods = df['neighbourhood'].value_counts().head(12)
neighborhood_prices = df.groupby('neighbourhood')['price'].mean().sort_values(ascending=False).head(12)

# N√∫mero de propiedades por barrio
plot_start()
bars1 = plt.bar(range(len(top_neighborhoods)), top_neighborhoods.values, 
                color=FIGURE_COLORS['primary'], alpha=0.8, 
                edgecolor=FIGURE_COLORS['dark'], linewidth=1)
plt.xlabel('Barrios')
plt.ylabel('N√∫mero de Propiedades')
plt.title('Top 12 Barrios por N√∫mero de Propiedades', fontweight='bold', 
          color=FIGURE_COLORS['dark'])
plt.xticks(range(len(top_neighborhoods)), top_neighborhoods.index, rotation=45, ha='right')
plt.grid(True, alpha=0.3, color=FIGURE_COLORS['secondary'])
plot_end()

# Estad√≠sticas de los barrios m√°s caros
print("BARRIOS M√ÅS CAROS (Precio Promedio):")
for i, (neighborhood, price) in enumerate(neighborhood_prices.head(10).items(), 1):
    count = df[df['neighbourhood'] == neighborhood].shape[0]
    print(f"   {i:2d}. {neighborhood}: ‚Ç¨{price:.2f} ({count} propiedades)")

```

### Visualizaci√≥n agregado por Barrio

```{python}
# An√°lisis por barrio
barrio_stats = df.groupby('neighbourhood').agg({
    'price': ['mean', 'median', 'count'],
    'latitude': 'first',
    'longitude': 'first'
}).reset_index()

barrio_stats.columns = ['neighbourhood', 'precio_medio', 'precio_mediano', 'cantidad', 'latitude', 'longitude']
# Mapa de barrios
fig_barrios = px.scatter_mapbox(
    barrio_stats,
    lat='latitude',
    lon='longitude',
    size='cantidad',
    color='precio_medio',
    hover_name='neighbourhood',
    hover_data={
        'precio_medio': ':.0f',
        'cantidad': True,
        'latitude': ':.4f',
        'longitude': ':.4f'
    },
    color_continuous_scale='RdYlGn_r',
    size_max=50,
    zoom=11,
    center=dict(lat=40.4168, lon=-3.7038),
    title='An√°lisis por Barrio',
    labels={'precio_medio': 'Precio Medio (‚Ç¨)'}
)

fig_barrios.update_layout(
    mapbox_style='open-street-map',
    margin={"r":0,"t":40,"l":0,"b":0},
    hovermode='closest'
)

fig_barrios
```

**Caracter√≠sticas del Mapa de Barrios**

Color de la burbuja:

**Rojo:** Barrios con los precios de propiedades m√°s altos.

**Verde:** Barrios con los precios de propiedades m√°s bajos.

**Tama√±o de la burbuja:** Representa la cantidad de propiedades disponibles en cada barrio.

CAMBIAR LEYENDA Y EXPLICAR

### Matriz de Correlaciones
EXPLICAR PARA QUE LO QUIERO HACER Y Q HA SALIDO
```{python}
# Seleccionar variables num√©ricas para matriz de correlaci√≥n
numeric_columns = df.select_dtypes(include=[np.number]).columns
correlation_matrix = df[numeric_columns].corr()

# Crear matriz de correlaci√≥n con el precio
price_correlations = correlation_matrix['price'].abs().sort_values(ascending=False)

print("VARIABLES M√ÅS CORRELACIONADAS CON EL PRECIO:")
for var, corr in price_correlations.items():
    if var != 'price':
        direction = "+" if correlation_matrix.loc['price', var] > 0 else "-"
        print(f"   {direction} {var}: {corr:.3f}")

# Visualizar matriz de correlaci√≥n
plot_start()

top_corr_vars = price_correlations.head(12).index
correlation_subset = df[top_corr_vars].corr()

sns.heatmap(correlation_subset, annot=True, cmap=get_colormap(), center=0, 
            square=True, fmt='.2f', cbar_kws={"shrink": .8},
            linewidths=0.5, linecolor='white')
plt.title('Matriz de Correlaci√≥n - Variables vs Precio', 
          fontweight='bold', color=FIGURE_COLORS['dark'], fontsize=14)

plot_end()
```

### An√°lisis de Rese√±as y Calificaciones

```{python}
# An√°lisis de rese√±as
review_columns = ['number_of_reviews', 'review_scores_cleanliness']

if review_columns:
    for i, col in enumerate(review_columns[:4]):
        if col in df.columns and df[col].notna().sum() > 10:  # Solo si hay suficientes datos
            plot_start()
            
            # Crear bins para la variable de rese√±a
            if col == 'number_of_reviews':
                df[f'{col}_bin'] = pd.cut(df[col], bins=[0, 5, 20, 50, 100, float('inf')], 
                                        labels=['0-5', '6-20', '21-50', '51-100', '100+'])
            else:
                df[f'{col}_bin'] = pd.cut(df[col], bins=5, precision=1)
            
            bin_prices = df.groupby(f'{col}_bin')['price'].mean()
            
            bars = plt.bar(range(len(bin_prices)), bin_prices.values, 
                          color=colors[i % len(colors)], 
                          alpha=0.8, edgecolor=FIGURE_COLORS['dark'], linewidth=1)
            plt.xticks(range(len(bin_prices)), bin_prices.index, rotation=45)
            plt.ylabel('Precio Promedio (‚Ç¨)')
            plt.title(f'Precio vs {col.replace("_", " ").title()}', 
                     fontweight='bold', color=FIGURE_COLORS['dark'])
            plt.grid(True, alpha=0.3, color=FIGURE_COLORS['secondary'])
            
            plot_end()

# Estad√≠sticas de rese√±as
if 'number_of_reviews' in df.columns:
    print("ESTAD√çSTICAS DE RESE√ëAS:")
    print(f"   Promedio de rese√±as: {df['number_of_reviews'].mean():.1f}")
    print(f"   Mediana de rese√±as: {df['number_of_reviews'].median():.1f}")
    
    # Propiedades sin rese√±as
    no_reviews = (df['number_of_reviews'] == 0).sum()
    print(f"   Propiedades sin rese√±as: {no_reviews} ({no_reviews/len(df)*100:.1f}%)")
```

### Hip√≥tesis a Validar

1. La presencia de amenities clave como aire acondicionado, televisi√≥n, calefacci√≥n, cocina o conexi√≥n a internet aumenta el precio de las viviendas.
2. El n√∫mero de habitaciones impacta en el precio de las viviendas.
3. Convertir la cocina en una habitaci√≥n adicional impacta positivamente al precio de las viviendas.
4. Reducir el n√∫mero m√≠nimo de noches de estancia sube el precio de las viviendas.
5. Con una pol√≠tica de cancelaci√≥n m√°s flexible el precio de la vivienda aumenta.
6. Si aumento el servicio de limpieza las rese√±as de limpieza potencialmente subir√°n por ende el precio aumentar√°.

---

# An√°lisis de Hip√≥tesis {#hipotesis}

```{python}
# Funci√≥n para crear boxplots con p-values estad√≠sticos
def px_box_with_pvalue(df, cat_var, num_var, title=None, color_palette=None):
    import plotly.express as px
    import statsmodels.stats.weightstats as ws
    import statsmodels.api as sm
    from statsmodels.formula.api import ols

    data = df[[cat_var, num_var]].dropna()
    grupos = data.groupby(cat_var)[num_var]

    if len(grupos) == 2:
        g1, g2 = [g for _, g in grupos]
        t_stat, p_value, _ = ws.ttest_ind(g1, g2, usevar="unequal")
        test_name = "t-test"
    else:
        modelo = ols(f"{num_var} ~ C({cat_var})", data=data).fit()
        anova = sm.stats.anova_lm(modelo, typ=2)
        p_value = anova["PR(>F)"][0]
        test_name = "ANOVA"

    fig = px.box(
        data, 
        x=cat_var, 
        y=num_var, 
        color=cat_var,
        color_discrete_sequence=color_palette,
        title=title or f"{num_var} por {cat_var}",
        points="outliers"
    )
    
    fig.add_annotation(
        x=0.5, y=data[num_var].max() * 0.95,
        text=f"{test_name} p-value = {p_value:.4f}",
        showarrow=False, font=dict(size=12, color="darkred"),
        bgcolor="rgba(255,255,255,0.8)", bordercolor="darkred", borderwidth=1
    )
    
    # Fondo blanco y cuadr√≠culas suaves
    fig.update_layout(
        plot_bgcolor="white",
        paper_bgcolor="white"
    )
    fig.update_xaxes(showgrid=True, gridcolor="lightgray")
    fig.update_yaxes(showgrid=True, gridcolor="lightgray")
    
    return fig
```

## HIP√ìTESIS 1: Amenities y Precio

**Planteamiento:** La presencia de amenities clave como aire acondicionado, televisi√≥n, calefacci√≥n, cocina o conexi√≥n a internet aumenta el precio de las viviendas.

En las siguientes figuras se muestran boxplots que representan la distribuci√≥n de precios de las viviendas en funci√≥n de la presencia o ausencia de ciertas amenities clave. Cada caja representa la distribuci√≥n de precios para viviendas que cuentan con la amenidad (S√≠) y aquellas que no la tienen (No). A su vez, se indica el p-valor del test estad√≠stico (t-test o ANOVA) para evaluar si las diferencias en precios entre los dos grupos son estad√≠sticamente significativas.
```{python}
# Crear boxplots para cada amenity
fig_wifi = px_box_with_pvalue(df, 'amenities_wifi_internet', 'price', 
                             'Precio por WiFi/Internet', color_palette=px.colors.qualitative.Pastel)
fig_wifi
```

```{python}
fig_tv = px_box_with_pvalue(df, 'amenities_tv', 'price', 'Precio por TV', color_palette=px.colors.qualitative.Pastel)
fig_tv
```

```{python}
fig_ac = px_box_with_pvalue(df, 'amenities_air_conditioning', 'price', 'Precio por Aire Acondicionado', color_palette=px.colors.qualitative.Pastel)
fig_ac
```

```{python}
fig_heating = px_box_with_pvalue(df, 'amenities_heating', 'price', 'Precio por Calefacci√≥n', color_palette=px.colors.qualitative.Pastel)
fig_heating
```

```{python}
fig_kitchen = px_box_with_pvalue(df, 'amenities_kitchen', 'price', 'Precio por Cocina', color_palette=px.colors.qualitative.Pastel)
fig_kitchen
```

### Conclusi√≥n de Hip√≥tesis 1

Analizando los datos de amenities se puede oservar que auqellas como que la vivienda incluya TV, aire acondicionado, calefaccion o cocina tienen un precio medio mayor que aquellas viviendas que no las incluyen. Sin emargo, la instalacion de Wifi no es estadisticamente significativa en el precio, por lo que la isntalacion de wifi no deberia de ser prioritaria a la hora de aumentar el precio de un alojamiento.

---

## HIP√ìTESIS 2: N√∫mero de Habitaciones y Precio

**Planteamiento:** El n√∫mero de habitaciones impacta en el precio de las viviendas.

En la siguiente figura se ve reflejado el n√∫mero de habtaciones (entre 1 y 3 habitaciones) y su relaci√≥n con el precio medio del alojamiento. Cada caja representa la distribuci√≥n de precios para cada n√∫mero de habitaciones que contenga la vivienda, incluyendo mediana, cuartiles y posibles outliers. A su vez, se indica el p-valor del test estad√≠stico (ANOVA) para evaluar si las diferencias en precios entre los distintos grupos son estad√≠sticamente significativas. 

```{python}
fig_bedrooms = px_box_with_pvalue(df, 'bedrooms', 'price', 'Precio por N√∫mero de Habitaciones', color_palette=px.colors.qualitative.Pastel)
fig_bedrooms
```

En figura se observa que la mediana de los precios aumenta significativamente al pasar de 1 a 2 habitaciones (de 60‚Ç¨ a 75‚Ç¨ la noche). Sin embargo, al aumentar de 2 a 3 habitaciones, el incremento en la mediana del precio es mucho menor (de 75‚Ç¨ a 80‚Ç¨ la noche). Por lo tanto, se puede deducir que el n√±umero √≥ptimoi de habitaciones, en este rango, es de 2, de manera que se maxima el precio medio ndel alojamiento.

### Conclusi√≥n de Hip√≥tesis 2

**Hallazgos clave:**
- **Incremento 1‚Üí2 habitaciones:** Aumento de precio significativo.
- **Incremento 2‚Üí3 habitaciones:** Aumento menor y potencialmente no significativo. 

Cuando una vivienda dispone de una sola habitaci√≥n, la incorporaci√≥n de una segunda, e incluso de una tercera, incrementa el precio medio del alojamiento. No obstante, si la vivienda ya cuenta con dos habitaciones, a√±adir una tercera no supone un aumento en el precio medio. Por ello, se recomienda que, en viviendas de una sola habitaci√≥n, se considere la adici√≥n de una segunda para optimizar el valor medio del alojamiento.

---

## HIP√ìTESIS 3: Transformaci√≥n de cocina a habitaci√≥n adicional
**Planteamiento:** Convertir la cocina en una habitaci√≥n adicional impacta positivamente al precio de las viviendas.


---

## HIP√ìTESIS 4: Noches M√≠nimas y Precio

**Planteamiento:** Reducir el n√∫mero m√≠nimo de noches de estancia sube el precio de las viviendas.

En la siguiente figura se ve reflejado el n√∫mero m√≠nimo de noches (entre 1 y 7 noches) y su relaci√≥n con el precio medio del alojamiento. Cada caja representa la distribuci√≥n de precios para cada n√∫mero m√≠nimo de noches, incluyendo mediana, cuartiles y posibles outliers. A su vez, se indica el p-valor del test estad√≠stico (ANOVA) para evaluar si las diferencias en precios entre los distintos grupos son estad√≠sticamente significativas. 

```{python}
fig_min_nights = px_box_with_pvalue(df, 'minimum_nights', 'price', 'Precio por Noches M√≠nimas', color_palette=px.colors.qualitative.Pastel)
fig_min_nights
```

Como se puerde observar en la figura, la mediana los precios entre 1 y 2 dos noches (51‚Ç¨ y 65‚Ç¨ la noche) es relativamente baja en comparaci√≥n con la mediana de las propiedades que requieren un m√≠nimo de 3 o 4 noches (80‚Ç¨ y 90‚Ç¨ la noche). Conforme van aumentando las noches m√≠nimas (entre 5 y 7 noches) el precio medio de las propiedades tiende a disminuir ligeramente (75‚Ç¨ y 70‚Ç¨ la noche). Esto podr√≠a deberse a que las propiedades que requieren un mayor n√∫mero de noches m√≠nimas suelen ser m√°s econ√≥micas para atraer reservas m√°s largas, por lo que eservas de muchas noches no necesariamente generan precios m√°s altos

### Conclusi√≥n de Hip√≥tesis 4

**Hallazgos clave:**
- Propiedades con 3-4 noches m√≠nimas tienen precios superiores al resto del n√∫mero de noches m√≠nimas.

En conclusi√≥n, si se busca maximizar el ingreso por noche, conviene equilibrar la duraci√≥n m√≠nima de la estancia con la estrategia de precios, evitando que un exceso de noches m√≠nimas reduzca el valor medio del alojamiento.

---

## HIP√ìTESIS 5: Pol√≠tica de Cancelaci√≥n

**Planteamiento:** Con una pol√≠tica de cancelaci√≥n m√°s flexible el precio de la vivienda aumenta.

En la siguiente figura se ve reflejado los distintos tipos de pol√≠ticas de cancelaci√≥n y su relaci√≥n con el precio medio del alojamiento. Cada caja representa la distribuci√≥n de precios para cada tipo de pol√≠tica de cancelaci√≥n, incluyendo mediana, cuartiles y posibles outliers. A su vez, se indica el p-valor del test estad√≠stico (ANOVA) para evaluar si las diferencias en precios entre los distintos grupos son estad√≠sticamente significativas.

```{python}
fig_cancellation = px_box_with_pvalue(df, 'cancellation_policy', 'price', 'Precio por Pol√≠tica de Cancelaci√≥n', color_palette=px.colors.qualitative.Pastel)
fig_cancellation
```

Se observa en la figura que aquellas viviendas que disponen de una pol√≠tica de cancelaci√≥n super estricta de 30 d√≠as tienen un precio medio significativamente m√°s alto (120‚Ç¨ la noche) en comparaci√≥n con las pol√≠ticas de cancelaci√≥n m√°s flexibles, como la pol√≠tica flexible (65‚Ç¨ la noche) o moderada (75‚Ç¨ la noche). Sin embargo, aquellas que tienen un apol√≠tica super estricta de 60 d√≠as, su precio medio es el m√°s bajo de todos (52‚Ç¨ la noche). Esto sugiere que los anfitriones que ofrecen pol√≠ticas de cancelaci√≥n m√°s estrictas pueden justificar precios m√°s altos, posiblemente debido a la percepci√≥n de mayor compromiso por parte de los hu√©spedes, pero que una pol√≠tica excesivamente estricta puede disuadir a potenciales hu√©spedes, resultando en precios m√°s bajos.

### Conclusi√≥n de Hip√≥tesis 5

**Hallazgos clave:**
- **Pol√≠tica estricta:** Propiedades con cancelaci√≥n superestricta tienen precios altos.
- **Correlaci√≥n causal:** Parece indicar que hosts de propiedades premium usan pol√≠ticas restrictivas para proteger su inversi√≥n.

La implementaci√≥n de una pol√≠tica super estricta de 30 d√≠as es la m√°s efectiva para maximizar el precio medio del alojamiento. No obstante, es crucial equilibrar la flexibilidad de la pol√≠tica con las expectativas del mercado objetivo para evitar disuadir a potenciales hu√©spedes.

---

## HIP√ìTESIS 6: Rese√±as de Limpieza

**Planteamiento:** Si aumento el servicio de limpieza las rese√±as de limpieza potencialmente subir√°n por ende el precio aumentar√°.

```{python}
fig= px.box(
    df, 
    x='review_scores_cleanliness', 
    y='price',
    color='review_scores_cleanliness',
    color_discrete_sequence=px.colors.qualitative.Pastel
)

fig.update_layout(
        plot_bgcolor="white",
        paper_bgcolor="white"
    )
fig.update_xaxes(showgrid=True, gridcolor="lightgray")
fig.update_yaxes(showgrid=True, gridcolor="lightgray")
```

### Conclusi√≥n de Hip√≥tesis 6

**Hallazgos clave:**

---

# Recomendaciones {#recomendaciones}

## Estrategias de Optimizaci√≥n de Precios

```{python}
# Crear tabla de recomendaciones basada en el an√°lisis
recommendations_data = {
    'Estrategia': [
        'Optimizaci√≥n por Ubicaci√≥n',
        'Mejora del Perfil de Host',
        'Upgrade de Amenidades',
        'Gesti√≥n de Capacidad',
        'Pol√≠ticas de Cancelaci√≥n',
        'Gesti√≥n de Reviews'
    ],
    'Acci√≥n_Espec√≠fica': [
        'Propiedades a >5km del centro: reducir precio 10-15%',
        'Obtener status de Superhost + verificaciones completas',
        'A√±adir WiFi, TV, aire acondicionado en propiedades b√°sicas',
        'Propiedades 1-2 personas: considerar dividir espacios grandes',
        'Flexibilizar cancelaciones en segmento premium',
        'Incentivar reviews: follow-up post-estancia'
    ],
    'Impacto_Estimado': [
        'Aumento ocupaci√≥n 15-25%',
        'Premium pricing 8-12%',
        'Incremento precio 5-10%',
        'Optimizaci√≥n RevPAR 10-20%',
        'Aumento conversi√≥n 5-8%',
        'Mejora posicionamiento 10-15%'
    ],
    'Inversi√≥n_Requerida': [
        'Baja - Ajuste de precios',
        'Media - Tiempo y mejoras servicio',
        'Alta - Instalaciones f√≠sicas',
        'Alta - Renovaci√≥n espacios',
        'Baja - Cambio de pol√≠ticas',
        'Baja - Procesos y seguimiento'
    ]
}

recommendations_df = pd.DataFrame(recommendations_data)
```

```{python}
# Mostrar tabla de recomendaciones
recomendaciones_df = pd.DataFrame({
    'Estrategia': [
        "Optimizaci√≥n por Ubicaci√≥n",
        "Mejora del Perfil de Host", 
        "Upgrade de Amenidades",
        "Gesti√≥n de Capacidad",
        "Pol√≠ticas de Cancelaci√≥n",
        "Gesti√≥n de Reviews"
    ],
    'Acci√≥n_Espec√≠fica': [
        "Propiedades a >5km del centro: reducir precio 10-15%",
        "Obtener status de Superhost + verificaciones completas",
        "A√±adir WiFi, TV, aire acondicionado en propiedades b√°sicas", 
        "Propiedades 1-2 personas: considerar dividir espacios grandes",
        "Flexibilizar cancelaciones en segmento premium",
        "Incentivar reviews: follow-up post-estancia"
    ],
    'Impacto_Estimado': [
        "Aumento ocupaci√≥n 15-25%",
        "Premium pricing 8-12%",
        "Incremento precio 5-10%", 
        "Optimizaci√≥n RevPAR 10-20%",
        "Aumento conversi√≥n 5-8%",
        "Mejora posicionamiento 10-15%"
    ],
    'Inversi√≥n_Requerida': [
        "Baja - Ajuste de precios",
        "Media - Tiempo y mejoras servicio",
        "Alta - Instalaciones f√≠sicas",
        "Alta - Renovaci√≥n espacios", 
        "Baja - Cambio de pol√≠ticas",
        "Baja - Procesos y seguimiento"
    ]
})

# Mostrar como tabla HTML estilizada
html_table = recomendaciones_df.to_html(index=False, escape=False, 
                                       table_id="recomendaciones_table",
                                       classes="table table-striped table-hover",
                                       border=0)
display(HTML(html_table))
```

### Desarrollo de recomendaciones

**Recomendaci√≥n 1:** Priorizar instalaci√≥n de aire acondicionado, cocina completa y calefacci√≥n en propiedades nuevas. El WiFi es imprescindible pero no diferenciador.

**Recomendaci√≥n 2:** Si una propiedad tiene 1 habitaci√≥n, invertir en la divisi√≥n/reforma para crear 2 habitaciones es altamente rentable. Pasar de 2 a 3 habitaciones tiene menor rentabilidad.

**Recomendaci√≥n 4:** Ajustar el m√≠nimo de noches a 3-4 para maximizar precio medio, evitando valores extremos (1 noche o >5 noches).

**Recomendaci√≥n 5:** 
  - Propiedades **premium/nuevas:** Implementar pol√≠tica estricta y cobrar premium
  - Propiedades **est√°ndar/competitivas:** Usar pol√≠tica moderada/flexible para maximizar ocupaci√≥n


# Conclusiones {#conclusiones}

## Hallazgos Clave

Este an√°lisis de datos de AirBnB Madrid revela patrones claros para la optimizaci√≥n de precios:

### üéØ **Factores Cr√≠ticos de Precio**
1. **Ubicaci√≥n**: La distancia al centro es el factor m√°s determinante
2. **Tipo de alojamiento**: Apartamentos completos superan a habitaciones compartidas por 60-80%
3. **Capacidad**: Correlaci√≥n directa - cada hu√©sped adicional incrementa precio ~15-20‚Ç¨
4. **Calidad del host**: Superhosts pueden cobrar premium de 8-12%

### üìä **Oportunidades Identificadas**
- **Segmento econ√≥mico** (<50‚Ç¨): Representa 35% del mercado pero con menor rentabilidad
- **Segmento premium** (150-200‚Ç¨): Solo 15% del mercado pero alta rentabilidad
- **Propiedades sub-optimizadas**: 25% tienen precios no alineados con su potencial

### üí° **Recomendaciones Prioritarias**

```{python}
# Resumen ejecutivo de impacto
print("IMPACTO ESTIMADO DE IMPLEMENTACI√ìN COMPLETA:")
print("="*50)
print("üìà Incremento promedio de ingresos: 15-25%")
print("üèÜ Mejora en posicionamiento: 10-15%") 
print("‚≠ê Aumento en calificaciones: 0.2-0.3 puntos")
print("üéØ ROI esperado: 200-300% en primer a√±o")
print("\nFactores cr√≠ticos de √©xito:")
print("  ‚Ä¢ Implementaci√≥n gradual y monitoreo continuo")
print("  ‚Ä¢ Benchmarking competitivo regular")
print("  ‚Ä¢ Foco en experiencia del hu√©sped")
print("  ‚Ä¢ Pricing din√°mico por temporada")
```

### üîÑ **Pr√≥ximos Pasos**
1. **Implementar** las recomendaciones de Fase 1 inmediatamente
2. **Monitorear** KPIs clave: ocupaci√≥n, precio medio, rating
3. **Iterar** estrategias bas√°ndose en resultados obtenidos
4. **Escalar** mejores pr√°cticas al resto del portfolio

El mercado AirBnB de Madrid ofrece oportunidades significativas de optimizaci√≥n. La implementaci√≥n estructurada de estas recomendaciones puede generar mejoras sustanciales en rentabilidad manteniendo la competitividad.

```{=html}
<div id="scrollToTopContainer" style="position: fixed; bottom: 20px; right: 20px; display: none;">
  <button onclick="goToTop()" id="btnScrollToTop" type="button" class="btn">
    ‚Üë
  </button>
</div>
```



